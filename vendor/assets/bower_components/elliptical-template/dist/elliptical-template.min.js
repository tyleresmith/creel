!function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e(require("elliptical-utils"),require("elliptical-class"),require("dustjs"),require("elliptical-dust-helpers")):"function"==typeof define&&define.amd?define(["elliptical-utils","elliptical-class","dustjs","elliptical-dust-helpers"],e):(t.elliptical.$Template=e(t.elliptical.utils,t.elliptical.Class,t.dust,t.dust.helpers),t.returnExports=t.elliptical.$Template)}(this,function(t,e,r,o){function i(t){return 0===t.indexOf(".")&&(t=v.trimFirstChar(t)),t}function n(t,e){var r=h(t._root);return c(r,e)}function c(t,e){e=i(e);for(var r=e.split("."),o=0;o<r.length;o++)t+="/"+r[o];return t+=".html"}function s(t,e,r,o){$.get(t).done(function(t){var i=e.compile(t,r);e.loadSource(i),o(null,t)}).fail(function(){o(new Error("Error: cannot find "+r+" in views folder"),null)})}function l(t,e,r){var o=n(t,e);s(o,t,e,r)}function a(t,e,r){var o=c("",e);s(o,t,e,r)}function u(t,e,r,o,i){var n=h(t.root),c=n+"/"+e+"/"+r+".html",s=e+"."+r,l=t.$provider;$.get(c,function(t){if(t){var e=l.compile(t,s);l.loadSource(e),l.render(s,o,i)}else i(new Error("Error: Controller View does not exist"),null)})}function d(t,e,r,o){var i=t.$provider,n=e+".html";e=f(e),s(n,i,e,function(t,n){i.render(e,r,o)})}function f(t){var e=t;return"/"===v.firstChar(t)&&(e=v.trimFirstChar(e)),e=e.replace(/\//g,".")}function h(t){return"/"===v.lastChar(t)?v.trimLastChar(t):t}var p="/app/views",b=t.object,v=t.string,_=t.network;r.optimizers.format=function(t,e){return e},r._root=p,r.onLoad=function(t,e){if(0===t.indexOf("."))t=i(t),a(r,t,e);else if(t.indexOf(".")>-1)l(r,t,e);else{var o=new Error("Partial Not Found: "+t);e(o,null)}};var m;return m=e.extend({_data:{},_$store:null,get $store(){return this._$store},set $store(t){this._$store=t},_base:{server:"base",client:"base-client"},get base(){return this._base},set base(t){this._base=t},_$provider:r,get $provider(){return this._$provider},set $provider(t){this._$provider=t,this._$provider._root=this._root},compile:r.compile,cache:r.cache,_model:"template",get model(){return this._model},set model(t){this._model=t},_api:"/api/template",get api(){return this._api},set api(t){this._api=t},_root:p,get root(){return this._root},set root(t){this._root=t,this._$provider._root=t},getBase:function(){return _.isBrowser()?this.base.client:this.base.server},setRoot:function(t){this.root=t,this._root=t,this._$provider._root=t},render:function(t,e,r){if(!t)return void console.warn("warning: cannot render null template");var o=this.$provider,i=o.cache,n=!1;n=i?b.isEmpty(i):!0,!n&&i[void 0!==t]?o.render(t,e,r):"object"==typeof t?this._renderTemplateObjectByControllerView(n,t,e,r):t.indexOf(".")>-1?this._renderTemplateByPathDotHierarchy(t,e,r):d(this,t,e,r)},setBrowserGlobal:function(){"undefined"!=typeof window&&(window.dust=this.$provider)},_renderTemplateObjectByControllerView:function(t,e,r,o){var i=this.$provider,n=i.cache,c=e.name.toLowerCase(),s=e.view.toLowerCase(),l=c+"."+s;t?u(this,c,s,r,o):n[l]?i.render(l,r,o):u(this,c,s,r,o)},_renderTemplateByPathDotHierarchy:function(t,e,r){var o=this,i=this.$provider;l(i,t,function(n,c){n?o._onRenderError(t,e,r):i.render(t,e,r)})},_onRenderError:function(t,e,r){var o=this.$provider;a(o,t,function(i,n){if(i)throw new Error(i);o.render(t,e,r)})}},{init:function(t){t&&(this.constructor._data.base=!0),this.root=this.constructor.root},render:function(t,e,r){if(this.constructor._data.base){var o={render:this.constructor.getBase()},i=this.constructor.$provider.makeBase(o);e=i.push(e)}this.constructor.render(t,e,r)}})});